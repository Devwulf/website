version: "3.8"
services:
  api-gateway:
    build:
      dockerfile: src/Gateway/Momentum.Gateway.Api/Dockerfile
      context: .
    image: api-gateway
    container_name: MomentumApiGateway${ENVIRONMENT}
    ports:
      - "${PORT}:80"
    restart: always
    environment:
      - ASPNETCORE_ENVIRONMENT=${ENVIRONMENT}
    volumes:
      - ./config/appsettings.json:/app/appsettings.json
      - ./config/appsettings.${ENVIRONMENT}.json:/app/appsettings.${ENVIRONMENT}.json
      - ./config/ocelot.json:/app/ocelot.json
    depends_on:
      - auth-api
  postgres:
    image: postgres
    container_name: MomentumPostgres${ENVIRONMENT}
    # Secrets can be hard coded since the DB is not internet facing
    environment:
      - POSTGRES_USER=momentum
      - POSTGRES_PASSWORD=momentum123
      - POSTGRES_DB=momentum_db
    volumes:
      - ./postgres:/var/lib/postgresql/data
  auth-api:
    build:
      dockerfile: src/Modules/Auth/Momentum.Auth.Api/Dockerfile
      context: .
    image: auth-api
    container_name: MomentumAuthApi${ENVIRONMENT}
    restart: always
    environment:
      - ASPNETCORE_ENVIRONMENT=${ENVIRONMENT}
    volumes:
      - ./config/appsettings.json:/app/appsettings.json
      - ./config/appsettings.${ENVIRONMENT}.json:/app/appsettings.${ENVIRONMENT}.json
    depends_on:
      - postgres